var jsonArr= new Array();var jsonTitleArr= new Array();var gNoArr= new Array();var json="";var gId="";var gTitle="";var gQuiz= "";var gAnswer= "";var gLang="";var gVoice="";var gInputType="";var gDescription="";var gChoiceArr=new Array();var gNextNo="";var startTime,endTime;var gAiconNormal="";var gAiconSmile="";var gAiconAngry="";var gAiconSadness="";var gQuizMax="";;function setJsonList(){jsonArr.length=0; jsonTitleArr.length=0;jsonArr.push("sample1.json"); jsonTitleArr.push("サンプル");gAiconNormal="s0-normal.png";gAiconNormal="s0-normal.png";gAiconSmile="s0-normal.png";gAiconAngry="s0-normal.png";gAiconSadness="s0-normal.png";};function setInitialValue(){gId="";gQuiz= "";gAnswer= "";gLang="";gVoice="";gInputType="";gDescription="";gChoiceArr.length=0;document.getElementById("QuizArea").innerHTML="";document.getElementById("AnswerArea").innerHTML="";startTime=Date.now();endTime="";};function quizFlow( argJsonNo ){var qNo;json="";gNoArr.length=0;getJson( jsonArr[argJsonNo] );gQuizMax=json.length-1;for(i=1; i<json.length; i++){ gNoArr.push( i ); };for (var i=gNoArr.length - 1; i >= 0; i--){var rand=Math.floor( Math.random() * ( i + 1 ) );[gNoArr[i], gNoArr[rand]]=[gNoArr[rand], gNoArr[i]]};gNextNo=0;setInitialValue();setZeroCellValue();setZeroQuizArea();setCommandArea("HideAnswerButton");pronounce(gLang,gVoice);document.getElementById("QuizAiconArea").src=gAiconNormal;document.getElementById("AnswerAiconArea").src=gAiconNormal;document.getElementById("AnswerArea").innerHTML="・・・";};function setCellValue( argNo ){gId=json[argNo].id;gQuiz= json[argNo].Quiz;gAnswer= json[argNo].Answer;gLang=json[argNo].Lang;if(json[argNo].Voice == ""){gVoice=json[argNo].Quiz;}else{gVoice=json[argNo].Voice;};gInputType=json[argNo].InputType;gDescription=json[argNo].Description;for(i=0; i<json[argNo].Choice.length; i++){gChoiceArr.push( json[argNo].Choice[i] );}};function setZeroCellValue(){gId=json[0].id;gTitle=json[0].Title;gQuiz= json[0].Quiz;gAnswer= json[0].Answer;gLang=json[0].Lang;if(json[0].Voice == ""){gVoice=json[0].Quiz;}else{gVoice=json[0].Voice;};gAiconNormal=json[0].aiconNormal;gAiconSmile=json[0].aiconSmile;gAiconAngry=json[0].aiconAngry;gAiconSadness=json[0].aiconSadness;};function setZeroQuizArea(){var qStr="";qStr+= gQuiz;document.getElementById("QuizArea").innerHTML=qStr;document.getElementById("AnswerAiconArea").src=gAiconNormal;document.getElementById("AnswerArea").innerHTML="↑のボタンをクリック";};function setQuizArea(){var qStr="";var aStr="";var loNo="";loNo=gNextNo + 1;qStr+= "【"+ gTitle +"】 " + "( " + loNo + "/"+gQuizMax+" ）<br />";qStr+= gQuiz;for (var i=gChoiceArr.length - 1; i >= 0; i--){var rand=Math.floor( Math.random() * ( i + 1 ) );[gChoiceArr[i], gChoiceArr[rand]]=[gChoiceArr[rand], gChoiceArr[i]]};qStr+= "<form id='"+ gId +"'>";for(i=0; i<gChoiceArr.length; i++){var choiceNo,choiceStr;choiceNo =gChoiceArr[i].slice(0,1);choiceStr=gChoiceArr[i].slice(2);qStr+= "<br /><input type='"+ gInputType +"' name='"+gId+"' value='"+choiceNo+"'>" + choiceStr;};qStr+= "</form>";document.getElementById("QuizArea").innerHTML=qStr;};function setCommandArea(argFlg){var cStr="";var cArea= "";if(argFlg != "END"){cArea="CommandArea";if(argFlg != "HideAnswerButton"){ cStr += "<a href='#'' class='square_btn' onclick='checkAnswer();'>回答する</a><br /><br />"; };cStr += "<a href='#'' class='square_btn' onclick='backQuiz();'>＜戻る</a>";cStr += " <a href='#'' class='square_btn' onclick='pronounce(gLang,gVoice);'>音声</a>";cStr += " <a href='#'' class='square_btn' onclick='nextQuiz();'>進む＞</a>";cStr += "<br />";cStr += "<br /><a href='#'' class='square_btn' onclick='showList();'>一覧に戻る</a>";}else{cArea="AnswerArea";cStr += "終了です";pronounce("ja", cStr);document.getElementById("AnswerAiconArea").src=gAiconSmile;};cStr="<p>" + cStr + "</p>";document.getElementById( cArea ).innerHTML=cStr;};function checkAnswer(){var ans="";var ansAicon="";var aStr="";var aVoice="";var aLang="";endTime=Date.now();var period=Math.round( (endTime-startTime)/1000 );for(i=0; i<document.forms[gId].length; i++){if(document.forms[gId].elements[i].checked){ans += document.forms[gId].elements[i].value;}};var patt=new RegExp(gAnswer);var res=patt.exec(ans);if(res != null){ans="正解です";ansAicon=gAiconSmile;}else{ans="不正解です";ansAicon=gAiconSadness;};aStr += ans + "<BR />" + gDescription;document.getElementById("AnswerAiconArea").src=ansAicon;document.getElementById("AnswerArea").innerHTML=aStr;aLang="ja";aVoice= ans;pronounce(aLang,aVoice);};function showList(){var sStr="";setJsonList();sStr += "";for(i=0; i<jsonArr.length; i++){ sStr += " <a href='#'' class='square_btn' onclick='quizFlow(" + i + ");'>"+jsonTitleArr[i]+"</a><br />"; };document.getElementById("QuizAiconArea").src=gAiconNormal;document.getElementById("QuizArea").innerHTML="問題集の一覧です<BR>"+sStr;document.getElementById("AnswerAiconArea").src=gAiconNormal;document.getElementById("AnswerArea").innerHTML="リストから選択";};function backQuiz(){gNextNo-=2;nextQuiz();};function nextQuiz(){if( gNextNo < gNoArr.length ){setInitialValue();setCellValue( gNoArr[gNextNo] );setQuizArea();setCommandArea("ShowAnswerButton");pronounce(gLang,gVoice);gNextNo+=1;document.getElementById("AnswerAiconArea").src=gAiconNormal;document.getElementById("AnswerArea").innerHTML="・・・";}else{setCommandArea("END");}};var walkJSON=function walkJSON(data, callback){for (var key in data) {callback(key, data[key]);if (typeof data[key] === "object") {walkJSON(data[key], callback);}}};function getJson( argJson ) {var req=new XMLHttpRequest();req.onreadystatechange=function() {if(req.readyState == 4 && req.status == 200){json=JSON.parse(req.responseText);}};req.open("GET", argJson, false);req.send(null);};function pronounce(argLang, argVoice) {var u=new SpeechSynthesisUtterance();u.lang=argLang;u.text=argVoice;u.rate=1.0;u.pitch=1.0;speechSynthesis.speak(u);}
